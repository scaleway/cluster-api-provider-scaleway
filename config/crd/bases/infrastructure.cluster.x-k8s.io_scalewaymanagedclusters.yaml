---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: scalewaymanagedclusters.infrastructure.cluster.x-k8s.io
spec:
  group: infrastructure.cluster.x-k8s.io
  names:
    categories:
    - cluster-api
    kind: ScalewayManagedCluster
    listKind: ScalewayManagedClusterList
    plural: scalewaymanagedclusters
    shortNames:
    - smc
    singular: scalewaymanagedcluster
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Cluster to which this ScalewayManagedCluster belongs
      jsonPath: .metadata.labels.cluster\.x-k8s\.io/cluster-name
      name: Cluster
      type: string
    - description: Ready is true when the managed cluster is fully provisioned
      jsonPath: .status.ready
      name: Ready
      type: boolean
    - description: Region of the managed cluster
      jsonPath: .spec.region
      name: Region
      type: string
    - description: Host of the control plane
      jsonPath: .spec.controlPlaneEndpoint.host
      name: Host
      type: string
    - description: Port of the control plane
      jsonPath: .spec.controlPlaneEndpoint.port
      name: Port
      type: integer
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ScalewayManagedCluster is the Schema for the scalewaymanagedclusters
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of ScalewayManagedCluster
            properties:
              controlPlaneEndpoint:
                description: ControlPlaneEndpoint represents the endpoint used to
                  communicate with the control plane.
                properties:
                  host:
                    description: host is the hostname on which the API server is serving.
                    maxLength: 512
                    type: string
                  port:
                    description: port is the port on which the API server is serving.
                    format: int32
                    type: integer
                required:
                - host
                - port
                type: object
                x-kubernetes-validations:
                - message: Value is immutable
                  rule: self == oldSelf
              network:
                description: Network defines the network configuration of the managed
                  cluster.
                properties:
                  privateNetwork:
                    description: PrivateNetwork allows attaching machines of the cluster
                      to a Private Network.
                    properties:
                      id:
                        description: Set a Private Network ID to reuse an existing
                          Private Network.
                        type: string
                        x-kubernetes-validations:
                        - message: Value is immutable
                          rule: self == oldSelf
                      subnet:
                        description: Optional subnet for the Private Network. Only
                          used on newly created Private Networks.
                        type: string
                        x-kubernetes-validations:
                        - message: Value is immutable
                          rule: self == oldSelf
                      vpcID:
                        description: Set the VPC ID where the new Private Network
                          will be created.
                        type: string
                        x-kubernetes-validations:
                        - message: Value is immutable
                          rule: self == oldSelf
                    type: object
                    x-kubernetes-validations:
                    - message: vpcID cannot be added or removed
                      rule: has(self.vpcID) == has(oldSelf.vpcID)
                    - message: id cannot be added or removed
                      rule: has(self.id) == has(oldSelf.id)
                    - message: subnet cannot be added or removed
                      rule: has(self.subnet) == has(oldSelf.subnet)
                    - message: subnet cannot be set when id is set
                      rule: has(self.id) && !has(self.subnet) || !has(self.id)
                    - message: vpcID cannot be set when id is set
                      rule: has(self.id) && !has(self.vpcID) || !has(self.id)
                  publicGateways:
                    description: |-
                      PublicGateways allows to create Public Gateways that will be attached to the
                      Private Network of the cluster.
                    items:
                      description: PublicGatewaySpec defines Public Gateway settings
                        for the cluster.
                      properties:
                        ip:
                          description: IP to use when creating a Public Gateway.
                          format: ipv4
                          type: string
                        type:
                          default: VPC-GW-S
                          description: Public Gateway commercial offer type.
                          type: string
                        zone:
                          description: |-
                            Zone where to create the Public Gateway. Must be in the same region as the
                            cluster. Defaults to the first zone of the region.
                          type: string
                      type: object
                    maxItems: 6
                    type: array
                type: object
              projectID:
                description: ProjectID in which the managed cluster will be created.
                minLength: 2
                type: string
                x-kubernetes-validations:
                - message: Value is immutable
                  rule: self == oldSelf
              region:
                description: Region where the managed cluster will be created.
                minLength: 2
                type: string
                x-kubernetes-validations:
                - message: Value is immutable
                  rule: self == oldSelf
              scalewaySecretName:
                description: |-
                  ScalewaySecretName is the name of the secret that contains the Scaleway client parameters.
                  The following keys are required: SCW_ACCESS_KEY, SCW_SECRET_KEY.
                  The following key is optional: SCW_API_URL.
                minLength: 1
                type: string
            required:
            - projectID
            - region
            - scalewaySecretName
            type: object
            x-kubernetes-validations:
            - message: controlPlaneEndpoint is required once set
              rule: '!has(oldSelf.controlPlaneEndpoint) || has(self.controlPlaneEndpoint)'
            - message: privateNetwork cannot be added or removed
              rule: (has(self.network) && has(self.network.privateNetwork)) == (has(oldSelf.network)
                && has(oldSelf.network.privateNetwork))
          status:
            description: status defines the observed state of ScalewayManagedCluster
            properties:
              network:
                description: Network contains information about currently provisioned
                  network resources.
                properties:
                  privateNetworkID:
                    description: PrivateNetworkID is the ID of the Private Network
                      that is attached to the cluster.
                    type: string
                type: object
              ready:
                description: |-
                  Ready denotes that the Scaleway managed cluster infrastructure is fully provisioned.
                  NOTE: this field is part of the Cluster API contract and it is used to orchestrate provisioning.
                  The value of this field is never updated after provisioning is completed.
                type: boolean
            type: object
        required:
        - spec
        type: object
        x-kubernetes-validations:
        - message: name must be between 1 and 63 characters
          rule: self.metadata.name.size() <= 63
        - message: name must be a valid DNS label
          rule: self.metadata.name.matches('^[a-z0-9]([-a-z0-9]*[a-z0-9])?$')
    served: true
    storage: true
    subresources:
      status: {}
